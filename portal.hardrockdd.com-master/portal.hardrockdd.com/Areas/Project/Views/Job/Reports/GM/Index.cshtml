@model portal.Areas.Project.Models.Job.Report.GrossMarginListViewModel

@{
    ViewBag.Title = "Job Gross Margin";
}

@section styles {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.dataTables.min.css" />
    @Styles.Render("~/csspage/inputcontrols")
}

<ol class="breadcrumb pull-right">
    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home" )">Home</a></li>
    <li class="breadcrumb-item active">@ViewBag.Title</li>
</ol>

<div class="row">
    <div class="col-xl-6">
        <form class="form-horizontal"
              id="StatementPeriod">
            <div class="form-group has-feedback row">
                <h1 class="page-header">@ViewBag.Title </h1>
                @Html.HiddenFor(m => m.GLCo, new { @id = Guid.NewGuid() })
                @Html.EditorFor(m => m.Mth)
            </div>
        </form>
    </div>
</div>
<div class="row">
    <div class="col-xl-6">
        <div id="">
        </div>
        <div id="StatementTransactions">
            @Html.Partial("Reports/GM/_Panel", Model)
        </div>
    </div>
    <div class="col-xl-6">
        <div class="reviewPanel" id="reviewPanel">
        </div>
    </div>
</div>


@section scripts {
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>
    @Scripts.Render("~/jspage/datatableExt")
    <script src="~/Content/assets/plugins/pdfjs/pdf.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.print.min.js"></script>
    @Scripts.Render("~/jspage/inputcontrols")
<script>
        $('#StatementPeriod').ready(function () { Form().init('#StatementPeriod'); });

        $('#StatementPeriod').on('change', '.Mth', function () {
            var data = $(this).closest('form').SerializeJson();
            $('#StatementTransactions').find('.panel').each(function () {
                var url = String($(this).data('reloadurl'));
                var newURL = url.substring(0, url.indexOf('?'));
                /*Rebuild reload url */
                var urlRoute = "";
                $.each(data, function (key, value) {
                    if (urlRoute !== "") {
                        urlRoute += "&"
                    }
                    urlRoute += key + "=" + value;
                });
                var newURL = newURL + "?" + urlRoute;
                //console.log(newURL, url);
                $(this).ReloadPanel(newURL);
            })
        })
</script>
}
