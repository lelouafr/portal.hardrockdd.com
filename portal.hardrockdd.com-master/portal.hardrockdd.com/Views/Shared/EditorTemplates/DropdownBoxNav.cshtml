@model object
@{
    var id = Html.IdFor(m => m).ToString();
    if (id.LastIndexOf("_") > 0)
    {
        id = id.Substring(id.LastIndexOf("_") + 1);
    }
    var idGuid = "group_" + Guid.NewGuid();
    var name = id;
    id = string.Concat(id, idGuid);


    var flushCache = bool.TryParse(ViewBag.FlushCache?.ToString(), out bool flushCasheOut) ? flushCasheOut : false;
    var prop = this.ViewData.ModelMetadata.PropertyName;
    var displayOnly = bool.TryParse(ViewBag.DisplayOnly?.ToString(), out bool displayOnlyOut) ? displayOnlyOut : false;
    var tableRow = bool.TryParse(ViewBag.TableRow?.ToString(), out bool tableRowOut) ? tableRowOut : false;

    var attributes = this.ViewData.ModelMetadata.AdditionalValues.TryGetValue("FieldAttribute", out object fldAttribute) ?
                            (FieldAttribute)fldAttribute :
                            new FieldAttribute();
    var formatString = (ViewData.ModelMetadata).DisplayFormatString;
    var tableSearch = bool.TryParse(ViewBag.TableSearch?.ToString(), out bool tableSearchOut) ? tableSearchOut : false;
    var title = this.ViewData.ModelMetadata.DisplayName;

    /**Define Html Attributes**/

    var dic = new Dictionary<string, object>();
    dic.Add("data-updrelatedpanes", attributes.UpdateRelatedPanes);
    dic.Add("data-cacheurl", attributes.CacheUrl);
    dic.Add("data-propertytitle", title);
    dic.Add("data-selectinit", "false");
    dic.Add("id", id);
    dic.Add("Name", name);
    //dic.Add("data-container", "#content");
    if (this.ViewData.ModelMetadata.IsRequired)
    {
        dic.Add("required", "");
        dic.Add("data-parsley-error-message", name + " is required");
    }
    dic.Add("data-flushcache", flushCache);
    dic.Add("data-search", tableSearch);
    dic.Add("data-size", "10");
    dic.Add("data-live-search", "true");
    dic.Add("data-style", "btn-white");
    if (!string.IsNullOrEmpty(attributes.ComboUrl))
    {
        dic.Add("data-combourl", attributes.ComboUrl);
    }
    if (!string.IsNullOrEmpty(attributes.ComboForeignKeys))
    {
        dic.Add("data-combokeys", attributes.ComboForeignKeys);
    }

    /**Define select list**/
    var selectList = new List<SelectListItem>();
    var item = new SelectListItem
    {
        Text = "",
        Value = Model == null ? "" : Model.ToString(),
        Selected = true
    };
    selectList.Add(item);

    //var labelSize = "col-lg-" + @attributes.LabelSize.ToString();

    var textSize = "";
    if (!tableRow)
    {
        textSize = "col-lg-" + @attributes.TextSize.ToString();

    }
}


<div class="@textSize input-group " id="@idGuid">
    @Html.DropDownListFor(f => f, selectList, @attributes.Placeholder, StaticFunctions.GetHtmlAttributes(new { @class = ("form-control " + prop) }, dic))
    
    @Html.ValidationMessageFor(m => m, "", new { @class = "invalid-feedback" })
</div>

@*<script>
    if (!$.isFunction(window.initDropdown)) {
        $('#@idGuid').ready(function () {
            var elem = $('#@idGuid #@id');
            initDropdown(elem, '@Model');
        });
    }
    else {
        var elem = $('#@idGuid #@id');
        initDropdown(elem, '@Model');
    }
</script>*@
