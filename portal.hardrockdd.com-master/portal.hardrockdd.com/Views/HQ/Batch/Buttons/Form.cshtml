@model portal.Models.Views.HQ.Batch.ButtonListViewModel
@{
    var viewOnly = bool.TryParse(ViewBag.ViewOnly?.ToString(), out bool viewOnlyOut) ? viewOnlyOut : false;
    var formLayout = new TableLayoutModel(this);
    var formId = "form_" + Guid.NewGuid();
}

<div id="@formId" class="row" >
    <div class="col-lg-12">
        <div class="pr-1 pl-1">
            @foreach (var action in Model.List)
            {
                <button type="button" 
                        class="btn @action.ButtonClass btnAction" 
                        data-posturl="@(action.ActionUrl)" 
                        data-redirectaction="@action.ActionRedirect" 
                        data-ajaxtype="@action.ActionType" 
                        data-key="@formLayout.TableKey">@action.Title</button>
            }
        </div>
    </div>
</div>

<script>
    $('#@formId').ready(function () {
        $('#@(formId)').on('click', 'button.btnAction', function () {
            var button = $(this);
            var ajaxType = $(button).data('ajaxtype');
            var url = $(button).data('posturl');
            if (ajaxType === "Get") {
                var data = "";
                console.log(url, data);
                OpenPopUpWindow(url, data, true, "batchModal");
            }
            else {
                $(button).SetButtonBusy();
                var redirectAction = $(button).data('redirectaction');
                var token = $(document).find('[name="__RequestVerificationToken"]');
                var data = {
                    __RequestVerificationToken: token.val(),
                    ActionRedirect: redirectAction,
                };

                var panel = $(this).closest('.panel');
                var refreshBtn = $(panel).find('[data-click="panel-reload"]');

                $.ajax({
                    type: "post",
                    dataType: "json",
                    url: url,
                    async: false,
                    data: data,
                    success: function (res) {
                        console.log(res);
                        if (res.success === "false") {
                        
                        }
                        $(button).SetButtonNotBusy();
                        $(refreshBtn).click();
                    }
                });
            }
        });

    });
</script>